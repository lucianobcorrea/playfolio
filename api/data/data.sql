DROP TABLE IF EXISTS user_account CASCADE;
DROP TABLE IF EXISTS game CASCADE;
DROP TABLE IF EXISTS user_game CASCADE;

CREATE TABLE user_account (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	name VARCHAR(100) NOT NULL,
	email VARCHAR(100) NOT NULL,
	password VARCHAR(100) NOT NULL,
	image VARCHAR(512) NOT NULL,
	active BOOLEAN NOT NULL
);
ALTER TABLE user_account ADD CONSTRAINT pk_user PRIMARY KEY (id);
ALTER TABLE user_account ADD CONSTRAINT uk_user_email UNIQUE (email);

CREATE TABLE game (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	name VARCHAR(100) NOT NULL,
	app_id BIGINT NOT NULL,
	description VARCHAR(512) NOT NULL,
	image VARCHAR(512) NOT NULL,
	status VARCHAR(8) NOT NULL,
	publish_date TIMESTAMP NOT NULL
);
ALTER TABLE game ADD CONSTRAINT pk_game PRIMARY KEY (id);
ALTER TABLE game ADD CONSTRAINT chk_status CHECK (status in ('FINISHED', 'COMPLETE', 'ONGOING'));

CREATE TABLE user_game (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	user_id BIGINT NOT NULL,
	game_id BIGINT NOT NULL
);
ALTER TABLE user_game ADD CONSTRAINT pk_user_game PRIMARY KEY (id);
ALTER TABLE user_game ADD CONSTRAINT fk_user_id FOREIGN KEY (user_id) references user_account;
ALTER TABLE user_game ADD CONSTRAINT fk_game_id FOREIGN KEY (game_id) references game;